#!/usr/bin/env zsh

# small shellscript to cd into your git tree and update it.

if [ "$1" = "--help" ]; then
	echo "update-configurations 0.1"
	echo
	echo "small shellscript to update your configurations git tree."
	echo
	exit 0
fi

if [ ! -e ~/bin ]; then
	echo "ERROR: you do not have a ~/bin symlink!" >&2
	exit 1
fi

RDLNK=""
if which readlink >/dev/null 2>&1; then
	RDLNK=readlink
elif which greadlink >/dev/null 2>&1; then
	RDLNK=greadlink
fi

if [ -z "$RDLNK" ]; then
	echo "ERROR: Your System is missing the readlink command" >&2
	exit 2
fi

git_tree=$($RDLNK ~/bin)

if [ -z "$git_tree" ]; then
	echo "ERROR: ~/bin is not a symlink!" >&2
	exit 3
fi

cd $git_tree/..
echo "Updating..."

head=$(git symbolic-ref HEAD)
head=${head/#refs\/heads\//}

case $head in
	master)
		git pull
		;;
	*)
		echo "Current branch: $head"
		if [ ! -e .git/remotes/$head ]; then
			echo "No remote named $head exists, aborting." >&2
			exit 3
		fi
		git pull $head
		;;
esac

echo "update done."
exit 0


